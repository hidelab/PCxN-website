<!DOCTYPE html>
<html>
	<head>
		<title>PCxN</title>
		<meta charset="utf-8"/>
		<meta property="og:url"                content="http://pcxn.org:8080/index.html" />
		<meta property="og:type"               content="website" />
		<meta property="og:title"              content="PCxN The Pathway Co-Activity Map" />
		<meta property="og:description"        content="A database for correlation of pathways/gene sets" />
		<meta property="og:image"              content="http://pcxn.org:8080/pcxnscreenshot1.png" />
		<meta name="viewport"     	       content="user-scalable=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, minimal-ui">
		 
		<!-- Load all .js and .css required -->
		<script src="js/canvasXpress.min.js"></script>
		<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css"/>
		<link rel="stylesheet" href="css/sbg.css"/>
		<script type="text/javascript" src="js/sbg.js"></script>
		<link rel="stylesheet" type="text/css" href="css/jquery.dataTables.css">
		<script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>	
		<script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
		<script type="text/javascript" src="js/jquery.dataTables.min.js"></script>
		<link href="shared/bootstrap/css/bootstrap.min.css" rel="stylesheet" />		
		<link rel="stylesheet" type="text/css" href="TableTools/css/dataTables.tableTools.css">
		<script type="text/javascript" src="TableTools/js/dataTables.tableTools.js"></script>
		<link rel="stylesheet" type="text/css" href="pcxn.css">
		<script src="js/cytoscape.js"></script>
		<script src="js/FileSaver.js"></script>
		<script src="js/cola.js"></script>
		<script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-spread/1.0.9/cytoscape-spread.js"></script>
		<script src="http://marvl.infotech.monash.edu/webcola/cola.v3.min.js"></script>
    		<script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-cola/1.1.1/cytoscape-cola.js"></script>
    		<script src="https://cdn.rawgit.com/cytoscape/cytoscape.js-cose-bilkent/1.0.5/cytoscape-cose-bilkent.js"></script>

		<script type="text/javascript">
		
			var pCutOffValue = 0.05;
			var topNValue = 0;
			var formResponse;
			var geneSetsValue;
			var	corrCutOffValue = 0.05;
			var	geneSetCollectionValue;
			var upGenesetNames = [];
			var downGenesetNames = [];
			var form2geneset="";
			var pathprintGeneSets = [];
			var mSigDBC2CPGeneSets = [];
			var mSigDBC5GeneSets = [];
		    	var mSigDBHGeneSets = [];
			var maxCorrInResponse = 0;
			var minPValueInResponse = 1;
			var maxCorrInResponseWithQuery = 0;
			var minPValueInResponseWithQuery = 1;
			var minCorrInHeatmap = 0;
			var maxCorrInHeatmap = 0;
			var heatmapColors = [];
			var cy = null;
			var cxHeatmap = null;
			var explore = true;
			var activeLayout = 'circle';
			var edgeWidth = 2;
			
			// Handler for Explore/Analyze decision
			$(document).ready(function(){
				// Access current domain's local Storage object. 
				var tmp = localStorage.getItem("explore");
    			if (tmp===null) {
                    tmp=="true"
                }
                explore = (tmp=="true");
                sizeCanvas();
                if(explore) {
					$("#form1").hide();
				} else {
					$("#form2").hide();
				}
				$(".result").hide();
    			var parms = {geneSetCollection :"all"};
    			// Get gene sets
				$.getJSON("getAvailableGeneSets.jsp", parms).done(handleAvailableGeneSetsResponse);
			});
				
			// Read what is submitted in the localStorage(user choices), depending on Explore/Analyze
			function checkLocalStorage() {
                //localStorage.clear();
			    var tmp = localStorage.getItem("explore");
    			if (tmp===null) {
                    tmp=="true"
                }
                explore = (tmp=="true");
                //alert(explore);
                if (!explore) {
                    document.getElementById("radioAnalysis2").checked = true;
                    tmp = localStorage.getItem("upgenesets");
    				if (tmp !== null) {
        				$("#upgenesets").val(tmp);
    				}
    					
    				tmp = localStorage.getItem("downgenesets");
    				if (tmp !== null) {
        				$("#downgenesets").val(tmp);
    				}
    					
                    tmp = localStorage.getItem("inputTopN");
                    if (tmp===null) {
                        tmp=0;
                    }
                    $("#inputTopN").val(tmp);
    			
                    tmp = localStorage.getItem("inputCorrelation");
                    if (tmp===null) {
                        tmp=0.05;
                    }
                    $("#inputCorrelation").val(tmp);

                    tmp = localStorage.getItem("inputpValue");
                    if (tmp===null) {
                        tmp=0.05
                    } 
                    $("#inputpValue").val(tmp);

                    tmp = localStorage.getItem("selectGeneSetCollection");
                    if (tmp===null) {
                        tmp ="MSigDBC2CP";
                    } 
                    $("#selectGeneSetCollection").val(tmp);
                        
                } else {
                    document.getElementById("radioAnalysis1").checked = true;
                    tmp = localStorage.getItem("inputTopN2");
                    if (tmp===null) {
                        tmp=10;
                    } 
                    $("#inputTopN2").val(tmp);
    			
                    tmp = localStorage.getItem("inputCorrelation2");
                    if (tmp===null) {
                        tmp=0.05;
                    } 
                    $("#inputCorrelation2").val(tmp);

                    tmp = localStorage.getItem("inputpValue2");
                    if (tmp===null) {
                        tmp=0.05;
                    }
                    $("#inputpValue2").val(tmp);

                    var form2genesetCollection = localStorage.getItem("form2genesetCollection");
                    form2geneset = localStorage.getItem("form2geneset");
                    if (form2genesetCollection !== null & form2geneset !== null) {
                        if (form2genesetCollection == "radioMSigDBH") {
                            document.getElementById("radioMSigDBH").checked = true;
                            $("#selectMSigDBH").val(form2geneset); 
                        } else if (form2genesetCollection == "radioMSigDBC2CP") {
                            document.getElementById("radioMSigDBC2CP").checked = true;
                            $("#selectMSigDBC2CP").val(form2geneset); 
                        } else if (form2genesetCollection == "radioMSigDBC5") {
                            document.getElementById("radioMSigDBC5").checked = true;
                            $("#selectMSigDBC5").val(form2geneset); 
                        } else if (form2genesetCollection == "radioPathprint") {
                            document.getElementById("radioPathprint").checked = true;
                            $("#selectPathprint").val(form2geneset); 
                        } else if (form2genesetCollection == "radioSearchGeneSet") {
                            document.getElementById("radioSearchGeneSet").checked = true;
                            $("#textfieldGeneSet").val(form2geneset); 
                        }
                    }
    			}
                tmp = localStorage.getItem("selectClusterMethod");
                if (tmp===null) {
                    tmp="complete";
                }
                $("#selectClusterMethod").val(tmp);
                
                tmp = localStorage.getItem("checkboxHeatmap");
                if (tmp===null) {
                    tmp="true";
                }
                document.getElementById("checkboxHeatmap").checked = (tmp=="true");
                
                tmp = localStorage.getItem("checkboxNetwork");
                if (tmp===null) {
                    tmp="true";
                }
                document.getElementById("checkboxNetwork").checked = (tmp=="true");
                
                tmp = localStorage.getItem("checkboxNetworkLegend");
                if (tmp===null) {
                    tmp="true";
                }
                document.getElementById("checkboxNetworkLegend").checked = (tmp=="true");
                
                tmp = localStorage.getItem("checkboxGeneList");
                if (tmp===null) {
                    tmp="true";
                }
                document.getElementById("checkboxGeneList").checked = (tmp=="true");
                
                tmp = localStorage.getItem("checkboxCorrelationTable");
                if (tmp===null) {
                    tmp="true";
                }
                document.getElementById("checkboxCorrelationTable").checked = (tmp=="true");
			}

			// Heatmap Canvas replacement
            function makeCanvasFitBoxContainer(selector) {
                // Throw away the canvas element and make a new one.
                var selected = $(selector)[0]
                var box = $(selected).closest('.box')[0]
                var id = selected.id
                var $newCanvas = $("<canvas>")
                $newCanvas.attr('id', id)
                $(box).children('div').replaceWith($newCanvas)
                var newCanvas = $newCanvas[0]
                newCanvas.style.width = '100%'
                newCanvas.style.height = '100%'
                newCanvas.width = box.offsetWidth - 30;
//                 console.log("fit", id, newCanvas.width)
                newCanvas.height = newCanvas.width
				if(document.getElementById("checkboxNetwork").checked & 
				(!document.getElementById("checkboxHeatmap").checked) &
				(!document.getElementById("checkboxNetworkLegend").checked) &
				(!document.getElementById("checkboxGeneList").checked)
				) {newCanvas.width = Math.max(window.innerWidth-60, newCanvas.width*2+100);}
            }

			// Network Div replacement
            function makeCytoNetworkFitBoxContainer(selector) {
                // Throw away the canvas element and make a new one.
//                 var selected = $(selector)[0]
//                 var box = $(selected).closest('.box')[0]
//                 var id = selected.id
//                 var $newCyto = $("<div>")
//                 $newCyto.attr('id', id)
// 				   console.log("cytoscape networks!!!")
//                 $(box).children('div').replaceWith($newCyto)
//                 var newCyto = $newCyto[0]
//                 newCyto.style.width = '100%'
//                 newCyto.width = box.offsetWidth-30;
//                 console.log("fit", id, newCyto.width)
//                 console.log("fit", id, newCyto.height)
				if(document.getElementById("checkboxNetwork").checked & 
				(!document.getElementById("checkboxHeatmap").checked) &
				(!document.getElementById("checkboxNetworkLegend").checked) &
				(!document.getElementById("checkboxGeneList").checked)
				) {newCyto.width = Math.max(window.innerWidth-60, newCyto
						.width*2+100);}
            }
			
			// Re-sizing heatmap/netwrok
            function sizeCanvas() {
            	if (document.getElementById("checkboxHeatmap").checked) {
                	makeCanvasFitBoxContainer('#canvas1');
                	$("#divHeatmap").parents().show();
                	$("#divHeatmap").show();
                	$("#divHeatmap").children().show();
                }
                if (document.getElementById("checkboxNetwork").checked) {
                	makeCytoNetworkFitBoxContainer('#cy');
                	$("#netWorkHeadLabel").parents().show();
                	$("#netWorkHeadLabel").show();
                	$("#divSliders").parents().show();
                	$("#divSliders").children().show();
                }
            }

			// Get the correct geneset
			function handleAvailableGeneSetsResponse (response) {
				pathprintGeneSets = response.pathprint;
				mSigDBC2CPGeneSets = response.MSigDBC2CP;
				mSigDBC5GeneSets = response.MSigDBC5;
                mSigDBHGeneSets = response.MSigDBH;
				var availableGenesets = pathprintGeneSets.concat(mSigDBC2CPGeneSets);
				availableGenesets = availableGenesets.concat(mSigDBC5GeneSets);
                availableGenesets = availableGenesets.concat(mSigDBHGeneSets);
				//alert(availableGenesets.length);
				$( "#textfieldGeneSet" ).autocomplete({
      				source: availableGenesets
    			});
    			
    			pathprintGeneSets = pathprintGeneSets.sort();
    			$('#selectPathprint')
         			.append($("<option></option>")
         			.attr("value","")
         			.text(""));
    			for(var i = 0; i < pathprintGeneSets.length; ++i){
					$('#selectPathprint')
         				.append($("<option></option>")
         				.attr("value",pathprintGeneSets[i])
         				.text(pathprintGeneSets[i])); 
				}
				
				mSigDBC2CPGeneSets = mSigDBC2CPGeneSets.sort();
				$('#selectMSigDBC2CP')
         			.append($("<option></option>")
         			.attr("value","")
         			.text("")); 
    			for(var i = 0; i < mSigDBC2CPGeneSets.length; ++i){
					$('#selectMSigDBC2CP')
         				.append($("<option></option>")
         				.attr("value",mSigDBC2CPGeneSets[i])
         				.text(mSigDBC2CPGeneSets[i])); 
				} 
				
				mSigDBC5GeneSets = mSigDBC5GeneSets.sort();
				$('#selectMSigDBC5')
         			.append($("<option></option>")
         			.attr("value","")
         			.text("")); 
    			for(var i = 0; i < mSigDBC5GeneSets.length; ++i){
					$('#selectMSigDBC5')
         				.append($("<option></option>")
         				.attr("value",mSigDBC5GeneSets[i])
         				.text(mSigDBC5GeneSets[i])); 
				}
                
                mSigDBHGeneSets = mSigDBHGeneSets.sort();
				$('#selectMSigDBH')
         			.append($("<option></option>")
         			.attr("value","")
         			.text("")); 
    			for(var i = 0; i < mSigDBHGeneSets.length; ++i){
					$('#selectMSigDBH')
         				.append($("<option></option>")
         				.attr("value",mSigDBHGeneSets[i])
         				.text(mSigDBHGeneSets[i])); 
				}
                checkLocalStorage();
			}
			
			getHeatmapColor = function(d, c, e) {
        		e = Number(e);
        		var a = ((e - d) * heatmapColors.length / (c - d)).toFixed() - 1;
        		return heatmapColors[Math.max(0, Math.min(heatmapColors.length - 1, a))]
    		};
			
    		// Handler for geneset choice, after "GO"
			function handleFormResponse(response) {				
				// Get unique geneset names
				if(!response) return;
				formResponse = response;
				if (formResponse.length==0){
					alert("None of your gene set names match those in the current database. The database is still in development. Please contact W.Wei@sheffield.ac.uk to help the development of the database.");
					return;
				}
				
				var u = {}, outputGenesetNames = [];
				for(var i = 0; i < formResponse.length; ++i){
					if(!u.hasOwnProperty(formResponse[i][0])) {
						outputGenesetNames.push(formResponse[i][0]);
						u[formResponse[i][0]] = 1;
					}
					if(!u.hasOwnProperty(formResponse[i][1])) {
						outputGenesetNames.push(formResponse[i][1]);
						u[formResponse[i][1]] = 1;
					}
				}
				
				var inputGeneSetNames = [];
				inputGeneSetNames = geneSetsValue.split("\n");
				
				var alertMessage =  " not match those in the current database:\n";
				var upperCaseOutputGenesetNames = [];
				for (var j = 0; j < outputGenesetNames.length; ++j){
					upperCaseOutputGenesetNames[j] = outputGenesetNames[j].toUpperCase();
				}
				var numberOfUnMatchedinputGenesets = 0;
				for ( var i = 0; i < inputGeneSetNames.length; ++i){
					var upperCaseInputGeneSetName = inputGeneSetNames[i].trim().toUpperCase();
					if (upperCaseOutputGenesetNames.indexOf(upperCaseInputGeneSetName) < 0) {
						alertMessage = alertMessage + inputGeneSetNames[i] + "\n"; 
						numberOfUnMatchedinputGenesets++;
					}
				}
					
				if (numberOfUnMatchedinputGenesets > 0) {
					var do_does = "do";
					if (numberOfUnMatchedinputGenesets ==1) {do_does = "does";}					
					alertMessage = numberOfUnMatchedinputGenesets + " of your gene set names " + do_does + alertMessage;
					alertMessage = alertMessage + "The database is still in development."
					alertMessage = alertMessage + "\nPlease contact W.Wei@sheffield.ac.uk to help the development of the database."
					alert(alertMessage);
					return;
				}
				
				displayResults ();				
				//$("#table2waiting").hide();
				//alert(formResponse[0]);
				//alert(formResponse[0][0]);
				outputGenesetNames.sort();
				//alert("The geneset names are:" + outputGenesetNames);
				var correlationMatrix = [];
				for(var i = 0; i < outputGenesetNames.length; ++i){
					correlationMatrix[i] = [];
					for (var j = 0; j < outputGenesetNames.length; ++j){
						correlationMatrix[i][j] = 0;
					}
				}
				
				for(var k = 0; k < formResponse.length; ++k){
					var indexA, indexB;
					for (var i = 0; i < outputGenesetNames.length; ++i){
						if(formResponse[k][0] == outputGenesetNames[i]) {
							indexA = i;
						}
						if(formResponse[k][1] == outputGenesetNames[i]) {
							indexB = i;
						}
					}
					correlationMatrix[indexA][indexB] = formResponse[k][2];
					correlationMatrix[indexB][indexA] = formResponse[k][2];
					if(formResponse[k][2] < minCorrInHeatmap){minCorrInHeatmap = formResponse[k][2];}
					if(formResponse[k][2] > maxCorrInHeatmap){maxCorrInHeatmap = formResponse[k][2];}
					var shrinkCor = formResponse[k][2];
					var pValue = formResponse[k][3];
					if (Math.abs(shrinkCor) > maxCorrInResponse) {maxCorrInResponse = Math.abs(shrinkCor);}
					if (pValue < minPValueInResponse) {minPValueInResponse = pValue;}
					if (
							(
								explore && 
								(	
									(formResponse[k][0].toUpperCase() == form2geneset.toUpperCase()) ||
									(formResponse[k][1].toUpperCase() == form2geneset.toUpperCase()) 
								)
							)|| 
							(
								(!explore) && 
								(
									(
										$("#upgenesets").val() && 
										(
											(upGenesetNames.indexOf(formResponse[k][0].toUpperCase()) >= 0) || 
											(upGenesetNames.indexOf(formResponse[k][1].toUpperCase()) >= 0)
										)
									) ||								
									(	
										$("#downgenesets").val() && 
										(
											(downGenesetNames.indexOf(formResponse[k][0].toUpperCase()) >=0) ||
											(downGenesetNames.indexOf(formResponse[k][1].toUpperCase()) >=0)
										) 
									)
								)
							)
						)
					{
						if (Math.abs(shrinkCor) > maxCorrInResponseWithQuery) {maxCorrInResponseWithQuery = Math.abs(shrinkCor);}
						if (pValue < minPValueInResponseWithQuery) {minPValueInResponseWithQuery = pValue;}						
					}					
				}
				
                sizeCanvas();
                document.getElementById("coefficientSlider").max=maxCorrInResponseWithQuery;
                //$(window).resize();
				
// 				   INPUT DATA
//                 console.log(outputGenesetNames)
//                 console.log(inputGeneSetNames)
//                 console.log (correlationMatrix)
// 				myColors = ['rgb(0,0,255)','rgb(7,7,255)','rgb(15,15,255)','rgb(23,23,255)','rgb(31,31,255)','rgb(39,39,255)','rgb(47,47,255)','rgb(55,55,255)','rgb(63,63,255)','rgb(71,71,255)','rgb(79,79,255)','rgb(87,87,255)','rgb(95,95,255)','rgb(103,103,255)','rgb(111,111,255)','rgb(119,119,255)','rgb(127,127,255)','rgb(135,135,255)','rgb(143,143,255)','rgb(151,151,255)','rgb(159,159,255)','rgb(167,167,255)','rgb(175,175,255)','rgb(183,183,255)','rgb(191,191,255)','rgb(199,199,255)','rgb(207,207,255)','rgb(215,215,255)','rgb(223,223,255)','rgb(231,231,255)','rgb(239,239,255)','rgb(247,247,255)',
//                				 'rgb(255,255,255)','rgb(255,247,247)','rgb(255,239,239)','rgb(255,231,231)','rgb(255,223,223)','rgb(255,215,215)','rgb(255,207,207)','rgb(255,199,199)','rgb(255,191,191)','rgb(255,183,183)','rgb(255,175,175)','rgb(255,167,167)','rgb(255,159,159)','rgb(255,151,151)','rgb(255,143,143)','rgb(255,135,135)','rgb(255,127,127)','rgb(255,119,119)','rgb(255,111,111)','rgb(255,103,103)','rgb(255,95,95)','rgb(255,87,87)','rgb(255,79,79)','rgb(255,71,71)','rgb(255,63,63)','rgb(255,55,55)','rgb(255,47,47)','rgb(255,39,39)','rgb(255,31,31)','rgb(255,23,23)','rgb(255,15,15)','rgb(255,7,7)','rgb(255,0,0)'];
				myColors = ['#0000ff','#0707ff','#0f0fff','#1717ff','#1f1fff','#2727ff','#2f2fff','#3737ff','#3f3fff','#4747ff','#4f4fff','#5757ff','#5f5fff','#6767ff','#6f6fff','#7777ff','#7f7fff','#8787ff','#8f8fff','#9797ff','#9f9fff','#a7a7ff','#afafff','#b7b7ff','#bfbfff','#c7c7ff','#cfcfff','#d7d7ff','#dfdfff','#e7e7ff','#efefff','#f7f7ff','#ffffff','#fff7f7','#ffefef','#ffe7e7','#ffdfdf','#ffd7d7','#ffcfcf','#ffc7c7','#ffbfbf','#ffb7b7','#ffafaf','#ffa7a7','#ff9f9f','#ff9797','#ff8f8f','#ff8787','#ff7f7f','#ff7777','#ff6f6f','#ff6767','#ff5f5f','#ff5757','#ff4f4f','#ff4747','#ff3f3f','#ff3737','#ff2f2f','#ff2727','#ff1f1f','#ff1717','#ff0f0f','#ff0707','#ff0000'];
				var cnv4=document.getElementById('canvas1');
				var ctx4=cnv4.getContext('2d');
				ctx4.clearRect(0, 0, canvas1.width, canvas1.height);
				var clusterMethod = $("#selectClusterMethod").val();
				//alert("Clustermethod: " + clusterMethod);				
				cxHeatmap = new CanvasXpress('canvas1',
					{
						"z": { "gs" : outputGenesetNames},
						"x": { "gs" : outputGenesetNames},
						"y": { "vars": outputGenesetNames,
							   "smps": outputGenesetNames,
							   "data": correlationMatrix}
					}, 
					{
							"graphType": "Heatmap",
							"linkage" : clusterMethod,
							"varLabelRotate": 0,
							"maxSmpStringLen" : 20,
							"maxVarStringLen": 20,
							"autoScaleFont" : false,
							"varLabelFontSize" : 10,
							"smpLabelFontSize" : 10,
							"minTextSize" : 12,
							"title": "",
							"disableMenu" : true,
							"disableToolbar" : true,
							"resizable" : true,
							"indicatorCenter" : "white",
							"colorSpectrum": myColors
							,
							"colorSpectrumZeroValue": 0
					},
					{
						'click' : function(o, e, t) {
							var eventDataId = t.getEventDataId(e);
							var selctedGeneSetName = "";
							if (eventDataId[0] && eventDataId[0].match(/Smp/)) {
								var A = eventDataId[0].split("-");
                                var H = parseInt(A[1]);
								selctedGeneSetName = t.data.y.smps[H];
							} else if (eventDataId[0] && eventDataId[0].match(/Var/)) {
								var A = eventDataId[0].split("-");
                                var H = parseInt(A[1]);
								selctedGeneSetName = t.data.y.vars[H];
							} else {
							}
							document.getElementById("selctedLeafName").innerHTML = selctedGeneSetName;
							var htmlLink = "";
							if (geneSetCollectionValue.match(/MSigDB/)) {
								htmlLink = "http://www.broadinstitute.org/gsea/msigdb/cards/" + selctedGeneSetName +".html";
							} else if (geneSetCollectionValue.match(/pathprint/)) {
								htmlLink = "http://www.genomemedicine.com/content/5/7/68";
							}
							document.getElementById("selctedLeafNameLink").innerHTML = htmlLink;
							document.getElementById("selctedLeafNameLink").href = htmlLink;
							updateTable2(selctedGeneSetName);
						}
					}
				);
				if (clusterMethod != "DoNotCluster") {
					cxHeatmap.clusterSamples();
					cxHeatmap.clusterVariables();
				}
				
// 				cxHeatmap.setRGB();
//         		var m = 256 / cxHeatmap.indicatorBins;
//         		var l = cxHeatmap.blues;
//         		heatmapColors = [];
//         		for (var h = 0; h < m; h++) {
//                     heatmapColors.push(l[h])
//                 }
                
//                 heatmapColors.push("rgb(255,255,255)");
//                 l = cxHeatmap.reds;
//                 for (var h = m - 1; h >= 0; h--) {
//                     heatmapColors.push(l[h])
//                 }

				heatmapColors = cxHeatmap.colorSpectrum;
				//Generating nodes and edges
				var nodes = [];
				var inNetwork ={};				
				var tableData = new Array();
				var edges = new Array();
				var edgeIndex = 0;
				for(var k = 0; k < formResponse.length; ++k){
					var shrinkCor = formResponse[k][2];
					var pValue = formResponse[k][3];
					if ( (Math.abs(shrinkCor) > corrCutOffValue) && (pValue < pCutOffValue) ) {
						tableData[edgeIndex] = formResponse[k];
						//var lineWidth = Math.abs(3*shrinkCor) + 1;
						var lineWidth = 1;
						edges[edgeIndex] = {"id1" : formResponse[k][0],
							"id2" : formResponse[k][1],
							"color" : getHeatmapColor(0-maxCorrInResponse, maxCorrInResponse, shrinkCor),
							"type" : "line",
							"width" : lineWidth,
							"value": shrinkCor};
						
						if(!inNetwork.hasOwnProperty(formResponse[k][0])) {
							inNetwork[formResponse[k][0]] = 1;
						}
						
						if(!inNetwork.hasOwnProperty(formResponse[k][1])) {
							inNetwork[formResponse[k][1]] = 1;
						}
						edgeIndex++;
					}					
				}
				
				//console.log(nodes);
				//console.log(edges);
				for(var i = 0; i < outputGenesetNames.length; ++i){
					if (inNetwork.hasOwnProperty(outputGenesetNames[i])) {
                    	var newNode;
						if((explore && form2geneset.toUpperCase()==outputGenesetNames[i].toUpperCase())| ((!explore) && $("#upgenesets").val() && (upGenesetNames.indexOf(outputGenesetNames[i].toUpperCase()) >= 0)) ) {
                        	// Member of the up-regulated geneset
							newNode = {"id": outputGenesetNames[i], "color" : "rgb(102,178,255)", "shape" : "sphere"};
						} else if((!explore) && $("#downgenesets").val() && (downGenesetNames.indexOf(outputGenesetNames[i].toUpperCase()) >=0) ) {
                        	// Member of the down-regulated geneset
							newNode = {"id": outputGenesetNames[i], "color" : "rgb(25,198,126)", "shape" : "sphere"};
						}
						else {
							newNode = {"id": outputGenesetNames[i], "color" : "rgb(255, 175, 26)", "shape" : "sphere", "size": "0.5"};
						}
						nodes.push(newNode)
					}
				}
				
				$("#table1").show();
				var t = $('#table1').DataTable({
					destroy: true,
					"columnDefs": [
						{ className: "dt-body-left", "targets": [ 0 ] },
						{ className: "dt-body-left", "targets": [ 1 ] },
						{ className: "dt-body-right", "targets": [ 2 ] },
						{ className: "dt-body-right", "targets": [ 3 ] },
						{ className: "dt-body-right", "targets": [ 4 ] }
					],
					"dom": 'T<"clear">lfrtip',		
					"tableTools": {
						"sSwfPath": "swf/copy_csv_xls_pdf.swf"
					}
				});
				t.clear();
				t.rows.add( tableData );
				t.draw();
				
///////////////////      -----------------------------------------------------      ///////////////////
/////////////////// 	|					  START cy					      |     ///////////////////
///////////////////      -----------------------------------------------------      ///////////////////
					
					var cy = window.cy = cytoscape({
					  
						container: document.getElementById('cy'),
					  
						layout: {name: 'cose',idealEdgeLength: 50,nodeOverlap: 20},    	  
						
						style: [
							{"selector":"core","style":{"selection-box-color":"#AAD8FF","selection-box-border-color":"#8BB0D0","selection-box-opacity":"0.5"}},
							
							// Node Styles
							// 1. Adjusted size
							{"selector":"node","style":{"width":"mapData(degree,0,12,40,120)","height":"mapData(degree,0,12,40,120)","content":"data(clean_id)","font-family":"verdana","font-style":"bold",'text-wrap': 'none', "text-max-width":80,"text-outline-color":"#e6e6e6","text-outline-width":"3px","font-size":"24px","text-valign":"center","text-halign":"center","background-color":"data(color)","color":"#001933","overlay-padding":"6px","z-index":"10"}},
							// 2. Adjusted size and multiple colored nodes
							//{"selector":"node","style":{'pie-size': '0%','pie-1-background-color': 'rgb(25,198,126)','pie-1-background-size': '50%','pie-2-background-color': 'rgb(102,178,255)','pie-2-background-size': '50%',"width":"mapData(degree,0,12,40,70)","height":"mapData(degree,0,12,40,70)","content":"data(id)","font-family":"verdana","font-style":"bold","text-outline-color":"#e6e6e6","text-outline-width":"2px","font-size":"18px","text-valign":"center","text-halign":"center","background-color":"data(color)","color":"#001933","overlay-padding":"6px","z-index":"10"}},
							// 3. Fixed size
							//{"selector":"node","style":{"width":"35px","height":"35px","content":"data(id)","font-family":"verdana","font-style":"bold","text-outline-color":"#e6e6e6","text-outline-width":"2px","font-size":"16px","text-valign":"center","text-halign":"center","background-color":"data(color)","color":"#001933","overlay-padding":"6px","z-index":"10"}},

							{"selector":"node[?attr]","style":{"shape":"roundrectangle","background-color":"#aaa","text-outline-color":"#aaa","width":"20px","height":"20px","font-size":"6px","z-index":"1"}},
							{"selector":"node[?query]","style":{"background-clip":"none","background-fit":"contain"}},
							{"selector":"node:selected","style":{"border-width":"8px","border-color":"#AAD8FF","border-opacity":"0.6","background-color":"#77828C","text-outline-color":"#95a3af"}},
							{"selector":"edge","style":{"curve-style":"haystack","haystack-radius":"2","font-family":"verdana",'text-wrap': 'wrap', "text-max-width":80,"font-style":"bold","text-outline-color":"#e6e6e6","text-outline-width":"2px","opacity":"0.8","line-color":"data(color)","width":"5","overlay-padding":"3px"}},
							{"selector":"node.unhighlighted","style":{"opacity":"0.2"}},{"selector":"edge.unhighlighted","style":{"opacity":"0.05"}},
							{"selector":".highlighted","style":{"z-index":"999999"}},
							{"selector":"node.highlighted","style":{"border-width":"6px","border-color":"#AAD8FF","border-opacity":"0.5","background-color":"#394855","text-outline-color":"#394855","shadow-blur":"12px","shadow-color":"#000","shadow-opacity":"0.8","shadow-offset-x":"0px","shadow-offset-y":"4px"}},
							{"selector":"edge.filtered","style":{"opacity":"0"}}
						],
					  
						elements: [],
					      		  
						 minZoom: 0.1,
						 maxZoom: 1.3,
						 userPanningEnabled: true, // Enables pinch/mouse wheel zoom				  
						 userPanningEnabled: true,				
						 boxSelectionEnabled: false,				  
						 selectionType: 'single', // new set of nodes every time
						 wheelSensitivity: 0.5
					
					});
								
					for (var i=0; i<nodes.length; i++) {

					    var pathway = nodes[i]
					    
					    if (pathway.color == 'rgb(25,198,126)') {clayer = 3;}
					    else if (pathway.color == 'rgb(102,178,255)') {clayer = 2;}
					    else {clayer = 1;}
					    cy.add([
					        {group: "nodes", data: {id: pathway.id, color: pathway.color, color_layer: clayer, clean_id: pathway.id.replace(/_/g , " ") }}
					    ])
					};
					
					for (var i=0; i<edges.length; i++) {

					    var link = edges[i]
					    cy.add([
					        {group: "edges", data: {id: link.id1 + ' - ' + link.id2, source: link.id1, target: link.id2, color: link.color }}
					    ])
					};
										
					// Show edge names on mouseover
					cy.on('mouseover','edge', function(event){
						  var target = event.cyTarget;
						  var target_id = target.data("id");
						  target.css({'label': target_id, "text-opacity":"1","font-size":"24px","font-style":"bold"});
						  //var x=event.cyPosition.x;
						  //var y=event.cyPosition.y; 
					});
					
					// Hide edge names on mouseout
					cy.on('mouseout','edge', function(event){
						  var target = event.cyTarget;
						  var target_id = target.data("id");
						  target.css({'label': target_id, "text-opacity":"0.0"});
					});

					cy.on('mousedown','edge', function(event){
						  var target = event.cyTarget;
						  var target_id = target.data("id");
						  var target_node = target.data("target");
						  var source_node = target.data("source");
						  target.css({"z-index":"999999"});
						  cy.nodes().css({"opacity":"0.5","z-index":"999998"});
						  cy.edges().css({"opacity":"0.3","z-index":"999997"});
						  cy.getElementById(target_node).css({'opacity': '1'});
						  cy.getElementById(source_node).css({'opacity': '1'});
						  cy.getElementById(target_id).css({'opacity': '1'});
					});
					
					cy.on('mouseup','edge', function(event){
						  var target = event.cyTarget;
						  var target_id = target.data("id");
						  var target_node = target.data("target");
						  var source_node = target.data("source");
						  target.css({"z-index":"999999"});
						  cy.nodes().css({"opacity":"1"});
						  cy.edges().css({"opacity":"1"});
					});
					
 					// Potential feature: Information URL on taphold
// 				    cy.on('taphold', 'node', function(event) {
// 				      	var target = event.cyTarget;
// 				      	var full_name = target.data("id");
// 				      	var bio_query = full_name.replace(/_/g," ");
// 				      	cy.nodes().unselect();
// 				      	window.open('https://www.ncbi.nlm.nih.gov/biosystems/?term=IL2RB' + bio_query);
// 				      	target.unselect();
// 				    });
		
					// Bring up the gene set's genes and url
				    cy.on('tap', 'node', function(event) {
				      	var target = event.cyTarget;
				      	var full_name = target.data("id");
				      	updateTable2(full_name);
						document.getElementById("selctedLeafName").innerHTML = full_name;
						var htmlLink = "";
						if (geneSetCollectionValue.match(/MSigDB/)) {
							htmlLink = "http://www.broadinstitute.org/gsea/msigdb/cards/" + full_name +".html";
						} else if (geneSetCollectionValue.match(/pathprint/)) {
							htmlLink = "http://www.genomemedicine.com/content/5/7/68";
						}
						document.getElementById("selctedLeafNameLink").innerHTML = htmlLink;
						document.getElementById("selctedLeafNameLink").href = htmlLink;
				    });
					
					// Get nodes' degree and link to their size
				    var degmap = {};
				    var nodes = cy.nodes();
				    for (var i = 0; i < nodes.length; i++) {
				      degmap[nodes[i].id()] = { degree: nodes[i].degree() };
				    }
				    cy.batchData(degmap);

					// Allow two colors for specific node
// 					cy.getElementById('Complement and coagulation cascades (KEGG)').css({'pie-size': '100%'});
				    
					// Setting the active layout
 					if (activeLayout == 'circle') {circleLayout();}
 					else if (activeLayout == 'grid') {gridLayout();}
 					else if (activeLayout == 'concentric') {concentricLayout();}
 					else if (activeLayout == 'spread') {spreadLayout();}
 					else if (activeLayout == 'cola') {colaLayout();}
				
///////////////////      -----------------------------------------------------      ///////////////////
/////////////////// 	|					  END cy					      |     ///////////////////
///////////////////      -----------------------------------------------------      ///////////////////
				
				var cnv=document.getElementById('canvas3');
				var ctx = cnv.getContext('2d');
				ctx.clearRect(0, 0, canvas3.width, canvas3.height);
				ctx.font = '20px "times new roman"';
				var heightOffset = 45;
				ctx.fillStyle='black';
				ctx.fillText("Network legend", 20, 45);
				var nodeLegedRadius = 10;
				if (explore){					
					ctx.strokeStyle = "rgb(255, 175, 26)";
					ctx.fillStyle="rgb(255, 175, 26)";
					ctx.beginPath();
					ctx.arc(35, 87.5+heightOffset, nodeLegedRadius, 0, Math.PI*2, false);
					ctx.fill();
					ctx.stroke();
					ctx.strokeStyle = "rgb(102,178,255)";
					ctx.fillStyle="rgb(102,178,255)"; 
					ctx.beginPath();
					ctx.arc(35, 42.5+heightOffset, nodeLegedRadius, 0, Math.PI*2, false);
					ctx.fill();
					ctx.stroke();
					ctx.font = '20px "times new roman"';
					ctx.fillStyle='black';
					ctx.fillText("Query gene set", 120, 50+heightOffset);
					ctx.fillText("Top gene sets correlated with query", 120, 95+heightOffset);
					ctx.fillText("Correlation", 160, 135+heightOffset);
					ctx.font = '15px "times new roman"';
					ctx.fillText(0-maxCorrInResponse.toFixed(2), 10, 155+heightOffset);
					ctx.fillText(maxCorrInResponse.toFixed(2), 140, 155+heightOffset);
					ctx.fillText("0", 81, 155+heightOffset);
					ctx.lineWidth = '8';
					var d=0;
					var colorWidth = 130/heatmapColors.length;
					for (var g = 0; g < heatmapColors.length; g++) {						
						ctx.beginPath();
						ctx.strokeStyle = heatmapColors[g];
						ctx.moveTo(20+d, 130+heightOffset);
						ctx.lineTo(20+colorWidth + d, 130+heightOffset);
						ctx.stroke();
						d=d+colorWidth;
					}
				} else	if( topNValue > 0) {
					ctx.strokeStyle = "rgb(25,198,126)";
					ctx.fillStyle="rgb(25,198,126)";
					ctx.beginPath();
					ctx.arc(35, 85+heightOffset, nodeLegedRadius, 0, Math.PI*2, false);
					ctx.fill();
					ctx.stroke();
					ctx.strokeStyle = "rgb(102,178,255)";
					ctx.fillStyle="rgb(102,178,255)"; 
					ctx.beginPath();
					ctx.arc(35, 42.5+heightOffset, nodeLegedRadius, 0, Math.PI*2, false);
					ctx.fill();
					ctx.stroke();
					ctx.fillStyle='black';
					ctx.fillText("Gene sets up-regulated in phenotype 0", 120, 50+heightOffset);
					ctx.fillText("Gene sets up-regulated in phenotype 1", 120, 92.5+heightOffset);
					ctx.fillText("Top correlated gene sets", 120, 135+heightOffset);			
					ctx.fillStyle="rgb(255, 175, 26)";
					ctx.strokeStyle="rgb(255, 175, 26)";
					ctx.beginPath();	
					ctx.arc(35, 125+heightOffset, nodeLegedRadius, 0, Math.PI*2, false);
					ctx.closePath();
					ctx.fill();
					ctx.stroke();
					ctx.fillStyle='black';
					ctx.fillText("Correlation", 160, 180+heightOffset);
					ctx.font = '15px "times new roman"';
					ctx.fillText(0-maxCorrInResponse.toFixed(2), 10, 200+heightOffset);
					ctx.fillText(maxCorrInResponse.toFixed(2), 140, 200+heightOffset);
					ctx.fillText("0", 81, 200+heightOffset);
					ctx.lineWidth = '8';
					var colorWidth = 130/heatmapColors.length;
					var d=0;
					for (var g = 0; g < heatmapColors.length; g++) {						
						ctx.beginPath();
						ctx.strokeStyle = heatmapColors[g];
						ctx.moveTo(20+d, 175+heightOffset);
						ctx.lineTo(20+colorWidth + d, 175+heightOffset);
						ctx.stroke();
						d=d+colorWidth;
					}
				} else {					
					ctx.strokeStyle = "rgb(25,198,126)";
					ctx.fillStyle="rgb(25,198,126)";
					ctx.beginPath();
					ctx.arc(35, 87.5+heightOffset, nodeLegedRadius, 0, Math.PI*2, false);
					ctx.fill();
					ctx.stroke();
					ctx.strokeStyle = "rgb(102,178,255)";
					ctx.fillStyle="rgb(102,178,255)"; 
					ctx.beginPath();
					ctx.arc(35, 42.5+heightOffset, nodeLegedRadius, 0, Math.PI*2, false);
					ctx.fill();
					ctx.stroke();					
					ctx.fillStyle='black';
					ctx.fillText("Gene sets up-regulated in phenotype 0", 120, 50+heightOffset);
					ctx.fillText("Gene sets up-regulated in phenotype 1", 120, 95+heightOffset);
					ctx.fillText("Correlation", 160, 135+heightOffset);
					ctx.font = '15px "times new roman"';
					ctx.fillText(0-maxCorrInResponse.toFixed(2), 10, 155+heightOffset);
					ctx.fillText(maxCorrInResponse.toFixed(2), 140, 155+heightOffset);
					ctx.fillText("0", 81, 155+heightOffset);
					ctx.lineWidth = '8';
					//var heatmapColors= cxHeatmap.heatmapColors;
					var d=0;
					var colorWidth = 130/heatmapColors.length;
					for (var g = 0; g < heatmapColors.length; g++) {						
						ctx.beginPath();
						ctx.strokeStyle = heatmapColors[g];
						ctx.moveTo(20+d, 130+heightOffset);
						ctx.lineTo(20+colorWidth + d, 130+heightOffset);
						ctx.stroke();
						d=d+colorWidth;
					}					
				}
			}
            
            function saveSettings(){
                localStorage.setItem("explore", document.getElementById("radioAnalysis1").checked);
				localStorage.setItem("upgenesets", $("#upgenesets").val());
				localStorage.setItem("downgenesets", $("#downgenesets").val());
				localStorage.setItem("inputTopN", $("#inputTopN").val());
                localStorage.setItem("inputCorrelation", $("#inputCorrelation").val());
				localStorage.setItem("inputpValue", $("#inputpValue").val());
				localStorage.setItem("selectGeneSetCollection", $("#selectGeneSetCollection").val());				
                localStorage.setItem("selectClusterMethod", $("#selectClusterMethod").val());
				localStorage.setItem("inputTopN2", $("#inputTopN2").val());
                localStorage.setItem("inputCorrelation2", $("#inputCorrelation2").val());
				localStorage.setItem("inputpValue2", $("#inputpValue2").val());
                localStorage.setItem("form2genesetCollection", $('input:radio[name=form2geneset]:checked').val()); 
            }

			function send(){
                saveSettings();				
                var upVal = $("#upgenesets").val();
				var downVal = $("#downgenesets").val();
				var newTopNValue = $("#inputTopN").val();
				var newPCutOffValue = $("#inputpValue").val();
				var newCorrCutOffValue = $("#inputCorrelation").val();
				var newGeneSetCollectionValue = $("#selectGeneSetCollection").val();
				var newGeneSetsValue;
                				
                // JSP API gets confused with leading and traling blank lines.
                // So eliminate those, and at the same time convert to upper case.
                upGenesetNames = upVal.trim().toUpperCase().split("\n")
                downGenesetNames = downVal.trim().toUpperCase().split("\n")
                $('#upgenesets').val(upGenesetNames.join("\n"))
                $('#downgenesets').val(downGenesetNames.join("\n"))

				if (upGenesetNames.length == 0 && downGenesetNames.length == 0)
				{
					alert("Please enter a list of gene sets!");
					return;
				}

                newGeneSetsValue = upGenesetNames.concat(downGenesetNames).join("\n").trim()

				if(((upGenesetNames.length + downGenesetNames.length)==1) && (newTopNValue==0)) {
					alert("Please specify the number of related gene sets to be found!");
					return;
				}

				if (newGeneSetsValue!=geneSetsValue |newTopNValue != topNValue | newPCutOffValue != pCutOffValue | newCorrCutOffValue != corrCutOffValue | newGeneSetCollectionValue != geneSetCollectionValue) {
					//alert("You have changed parameters!")
					geneSetsValue = newGeneSetsValue;
					topNValue = newTopNValue;					
					pCutOffValue = newPCutOffValue;
					corrCutOffValue = newCorrCutOffValue;
					geneSetCollectionValue = newGeneSetCollectionValue;
					$(".result").hide();
					//$("#divResult").find('*').hide();
					var parms = {genesets : geneSetsValue, topN : topNValue , pCutOff : pCutOffValue, corrCutOff : corrCutOffValue, geneSetCollection :geneSetCollectionValue};
					$.getJSON("getCorrelation.jsp", parms).done(handleFormResponse);
				} else {
					//alert("You have not changed parameters!")
					handleFormResponse(formResponse);
				}
			};
			
			function sendForm2(){
                saveSettings();               	
				var form2genesetCollection = $('input:radio[name=form2geneset]:checked').val();
                //var form2geneset="";

				if(form2genesetCollection =="radioPathprint") {
					form2geneset= $('#selectPathprint').val();
				} else if (form2genesetCollection == "radioMSigDBC2CP") {
					form2geneset=$('#selectMSigDBC2CP').val();
				} else if (form2genesetCollection == "radioMSigDBC5") {
					form2geneset=$('#selectMSigDBC5').val();
				} else if (form2genesetCollection == "radioMSigDBH") {
					form2geneset=$('#selectMSigDBH').val();
				} else {
					form2geneset=$('#textfieldGeneSet').val();
				}
				
                localStorage.setItem("form2geneset", form2geneset);
                
				var newGeneSetsValue = form2geneset;
                var newGeneSetCollectionValue = "";
				if(mSigDBC2CPGeneSets.indexOf(newGeneSetsValue) >=0) {
					newGeneSetCollectionValue = "MSigDBC2CP";
				}
				else if(mSigDBC5GeneSets.indexOf(newGeneSetsValue) >=0) {
					newGeneSetCollectionValue = "MSigDBC5";
				}
				else if(pathprintGeneSets.indexOf(newGeneSetsValue) >=0) {
					newGeneSetCollectionValue = "pathprint";
				}
                else if(mSigDBHGeneSets.indexOf(newGeneSetsValue) >=0) {
					newGeneSetCollectionValue = "MSigDBH";
				}
				else {
					alert("Your gene set is not in the database");
					return;
				}
				
				var newTopNValue = $("#inputTopN2").val();
				var newPCutOffValue = $("#inputpValue2").val();
				var newCorrCutOffValue = $("#inputCorrelation2").val();
				var newGeneSetsValue;
                				                
				if(newTopNValue==0) {
					alert("Please specify the number of related gene sets to be found!");
					return;
				}

				if (newGeneSetsValue!=geneSetsValue |newTopNValue != topNValue | newPCutOffValue != pCutOffValue | newCorrCutOffValue != corrCutOffValue | newGeneSetCollectionValue != geneSetCollectionValue) {
					//alert("You have changed parameters!")
					geneSetsValue = newGeneSetsValue;
					topNValue = newTopNValue;					
					pCutOffValue = newPCutOffValue;
					corrCutOffValue = newCorrCutOffValue;
					geneSetCollectionValue = newGeneSetCollectionValue;
					$(".result").hide();
					//$("#divResult").find('*').hide();
					var parms = {genesets : geneSetsValue, topN : topNValue , pCutOff : pCutOffValue, corrCutOff : corrCutOffValue, geneSetCollection :geneSetCollectionValue};
					$.getJSON("getCorrelation.jsp", parms).done(handleFormResponse);
				} else {
					//alert("You have not changed parameters!")
					handleFormResponse(formResponse);
				}
			};
			
			function updateTable2(geneSetNameValue) {
				$('#table2').hide();
				$("#table2waiting").show();
				$("#checkboxGeneList").prop('checked', true);
				//var geneSetNameValue = document.getElementById("selctedLeafName").innerHTML;
				var parms = {geneSetCollection : geneSetCollectionValue, geneSetName : geneSetNameValue};
				$.getJSON("getGeneSetMembers.jsp", parms).done(handleTable2Response);
			}
			
			function handleTable2Response(response) {
				var tableData = response;
				var tableSelector = '#table2';				
				for(var k = 0; k < tableData.length; ++k){
					var entrezid = tableData[k][0];
					var htmlLink = "http://www.ncbi.nlm.nih.gov/gene/" + entrezid;
					var el = '<a target="_blank" href=' + htmlLink +">" + entrezid + "</a>";
					tableData[k][0] = el;				
				}
				var t = $(tableSelector).DataTable({
					destroy: true,
					"columnDefs": [
						{ className: "dt-body-right", "targets": [ 0 ] },
						{ className: "dt-body-left", "targets": [ 1 ] },
						{ className: "dt-body-right", "targets": [ 2 ] }
					],
					"dom": 'T<"clear">lfrtip',		
					"tableTools": {
						"sSwfPath": "swf/copy_csv_xls_pdf.swf"
					}
				});
				t.clear();
				t.rows.add( tableData );
				t.draw();
				$(tableSelector).parents().show();
			 	$(tableSelector).show();
			 	$(tableSelector).children().show();
			 	$("#table2waiting").hide();
			}
			
			function doneResizing() {
				//alert("I'm done resizing for the moment");
				handleFormResponse(formResponse);
			};
			
			function hideOptionsAndResults() {
				$(".result").hide();
				$(".result").find('*').hide();
				$("#divResult").find('*').hide();
				$("#label1").hide();
				$("#inputCorrelation2").hide();
				$("#label2").hide();
				$("#inputpValue2").hide();
				$("#button4").hide();
				$("#button3").hide();
				$("#divShareButtons").hide();
			}
						
			var resizeTimer;
			$(window).resize(function() {
				clearTimeout(resizeTimer);
				resizeTimer = setTimeout(doneResizing, 100);
			});
			
			function saveHeatmapAsPNG() {cxHeatmap.print();}
			function saveNetworkAsJPG() {var jpg = cy.jpg({ full: true });downloadJpg(jpg, "graph_download.jpg");}
			function saveNetworkAsJSON() {var json = cy.elements().jsons();downloadJson(json, "graph_download.json");}

			function downloadJpg(data, filename) {
			    var pom = document.createElement('a');
			    pom.setAttribute('href', data);
			    pom.setAttribute('download', filename);

			    if (document.createEvent) {
			        var event = document.createEvent('MouseEvents');
			        event.initEvent('click', true, true);
			        pom.dispatchEvent(event);
			    }
			    else {
			        pom.click();
			    }
			}
			
			function downloadJson(data, filename) {
				var pom = document.createElement('a');
				var dataStr = JSON.stringify(data);
			    var dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
			    pom.setAttribute('href', dataUri);
			    pom.setAttribute('download', filename);
			    
			    if (document.createEvent) {
			        var event = document.createEvent('MouseEvents');
			        event.initEvent('click', true, true);
			        pom.dispatchEvent(event);
			    }
			    else {
			        pom.click();
			    }
			}
			
			// Different Network Layouts
			function gridLayout() {
				cy.nodes().css({'text-wrap': 'none', "text-max-width":80});				
				cy.layout({  
					name: 'grid',
					fit: true,
					columns: 2,
					animate: true, 
					sort: function(a, b){ return b.data('color_layer') - a.data('color_layer') } // Sort nodes by color (per row)
				});
				activeLayout = 'grid';
			}
			
			function circleLayout() {
				cy.nodes().css({'text-wrap': 'wrap', "text-max-width":80});
				cy.layout({  
					name: 'circle',
					fit: true,
					clockwise: false,
					animate: true, 
					radius: 900, 
					avoidOverlap: false, 
					sort: function(a, b){ return b.data('color_layer') - a.data('color_layer') } // Sort nodes by color
				});
				activeLayout = 'circle';
			}
			
			function colaLayout() { // Needs work
				cy.nodes().css({'text-wrap': 'none', "text-max-width":80});
				cy.layout({  
					name: 'cola', 
					fit: true,
					animate: true, 
					nodeSpacing: function( node ){ return 10; } 
				});
				activeLayout = 'cola';
			}
			
   			function concentricLayout() {
   				cy.nodes().css({'text-wrap': 'wrap', "text-max-width":80});
   				cy.layout({   					
   					name: 'concentric',
   					fit: true,
   					animate: true,
   		            concentric: function( node ){ return -(node.data('color_layer'));},
   					levelWidth: function( nodes ){ return 1;}, 
   					avoidOverlap: true,
   				}) 	
				activeLayout = 'concentric';
   			}
   			
			function coseBilkentLayout() {
				cy.nodes().css({'text-wrap': 'none', "text-max-width":80});
				cy.layout({  
					name: 'cose-bilkent', 
					fit: true,
 					numIter: 500, 
					animate: 'during', 
					gravity: 0.9,
 					nodeRepulsion: 500000, 
 					idealEdgeLength: 150
				});
				activeLayout = 'coseBilkent';
			} 
			
			function spreadLayout() {
				cy.nodes().css({'text-wrap': 'none', "text-max-width":80});
				cy.layout({ 
					name: 'random',
					minDist: 40,
					expandingFactor: 2.0,
					fit: true,
					animate: true
				});
				activeLayout = 'spread';
			}
			
			function centerLayout() {cy.center();cy.fit(cy.nodes());} 
			
			function edgewidth() {				
				if (edgeWidth == 2) {cy.edges().css({"width":"5"});edgeWidth = 5;}
				else {cy.edges().css({"width":"2"});edgeWidth = 2;}
			}
			
		</script>
	</head>
	<body>
		<div class="container-fluid">
			<div class="row" id="divHeader">
				<div class="col-sm-12">
					<div class="col-sm-8">						
						<h1><span style="font-size: 1em;"><a href="index.html"><img src="journal125.png" width="10%" height="10%" style="padding-right: 9px; vertical-align: bottom"></a>PCxN&nbsp</span><span style="font-size: 0.8em;">The Pathway Co-Activity Map</span></h1>
					</div>
					<div class="col-sm-4" id="menu">
						<ul>
							<li class="first"><a href="index.html" accesskey="1" title="">Home</a></li>
							<li><a href="news.html" accesskey="2" title="">News</a></li>
							<li><a href="about.html" accesskey="3" title="">About</a></li>						
							<li><a href="contacts.html" accesskey="4" title="">Contacts</a></li>
						</ul>
					</div>
				</div>
			</div>
			<div class="row" id="divInput">
				<div class="col-sm-6">
					<form id="form2" name="form2" class="well">						
						<label for="inputTopN2">Find top</label>
						<input type="text" id="inputTopN2" value="10"/><label> gene sets</label><br>
						<label>Correlated with</label><br>	
                        <input type="radio" id="radioMSigDBH" name="form2geneset" value="radioMSigDBH" checked>Select a gene set from MSigDB H (Hallmark gene sets)						    
						<br>
						<select id="selectMSigDBH" size="1">
						</select><br>
						<input type="radio" id="radioMSigDBC2CP" name="form2geneset" value="radioMSigDBC2CP" checked>Select a gene set from MSigDB C2 CP (Canonical pathways)						    
						<br>
						<select id="selectMSigDBC2CP" size="1">
						</select><br>
						<input type="radio" id="radioMSigDBC5" name="form2geneset" value="radioMSigDBC5">Select a gene set from MSigDB C5 GO BP gene sets						    
						<br>
						<select id="selectMSigDBC5" size="1">
						</select><br>
						<input type="radio" id="radioPathprint" name="form2geneset" value="radioPathprint">Select a gene set from Pathprint						    
						<br>
						<select id="selectPathprint" size="1">
						</select>
						
						<br>
						<input type="radio" id="radioSearchGeneSet" name="form2geneset" value="radioSearchGeneSet">Search a gene set 
						<input id="textfieldGeneSet" onkeypress="hideOptionsAndResults()">																
						<br>																	
						<label id="label1" for="inputCorrelation2"> with absolute correlation coefficient greater than</label><br>
						<input type="text" id="inputCorrelation2" value="0.05"/><br>
						
						<label id="label2" for="inputpValue2">and p-value less than</label><br>
						<input type="text" id="inputpValue2" value="0.05"/><br><br> 
						
						<input type="reset" id="button4" value=" Reset "/>												
						<input type="button" id="button3" value=" GO " onclick="javascript:sendForm2();"/>
					</form>
					
					<form id="form1" name="form1" class="well">
						<label for="upgenesets">Find correlation among gene sets up-regulated in phenotype 0</label><br>
						<textarea rows="7" cols="50" id="upgenesets"></textarea><br>
						
						<label for="downgenesets">and gene sets up-regulated in phenotype 1 </label><br>
						<textarea rows="7" cols="50" id="downgenesets"></textarea><br>
						
						<label for="inputTopN">and top</label>
						<input type="text" id="inputTopN" value="0"/><label>correlated genes sets</label><br>
						
						<label for="inputCorrelation"> with absolute correlation coefficient greater than</label>
						<input type="text" id="inputCorrelation" value="0.05"/><br>
						
						<label for="inputpValue">and p-value less than</label>
						<input type="text" id="inputpValue" value="0.05"/><br>
						
						<label for="selectGeneSetCollection">The gene sets are from</label>
						<select id="selectGeneSetCollection" size="1">
							<option value="pathprint">Pathprint</option>
                            <option value="MSigDBH" selected="selected">MSigDB H (Hallmark gene sets)</option>
						    <option value="MSigDBC2CP">MSigDB C2 CP (Canonical pathways)</option>
						    <option value="MSigDBC5">MSigDB C5 GO BP gene sets</option>
						</select>
						<br>
						<label for="selectClusterMethod">Cluster gene sets using</label><br>
						<select id="selectClusterMethod" size="1">
							<option value="average">Average linkage</option>
						    <option value="complete" selected="selected">Complete linkage</option>
						    <option value="single">Single linkage</option>
							<option value="DoNotCluster">Do not cluster</option>
						</select> 												
						<input type="reset" id="button2" value=" Reset "/>
						<input type="button" id="button1" value=" GO " onclick="javascript:send();"/>
					</form>
				</div>
				<div class="col-sm-6" style="padding-left: 20px;">
					<div class="col-sm-12" id="divAnalysis1">
						<h4><input type="radio" id="radioAnalysis1" name="radioAnalysis" value="radioAnalysis1" checked>Explore</h4>
						<p>Select a single pathway/gene set from one of the four collections (
                        <a target="_blank" href="http://www.broadinstitute.org/gsea/msigdb/index.jsp">MSigDB</a> H hallmark gene sets,
						<a target="_blank" href="http://www.broadinstitute.org/gsea/msigdb/index.jsp">MSigDB</a> C2 Canonical pathways, 
						<a target="_blank" href="http://www.broadinstitute.org/gsea/msigdb/index.jsp">MSigDB</a> C5 GO BP gene sets, and 
						<a target="_blank" href="http://www.genomemedicine.com/content/5/7/68">Pathprint</a>
						) and discover its correlated pathway/gene sets within the same collection.</p>
					</div>
					<div class="col-sm-12">
						<br><br><br>
					</div>
					<div class="col-sm-12" id="divAnalysis2">
						<h4><input type="radio" id="radioAnalysis2" name="radioAnalysis" value="radioAnalysis2">Analyze</h4>
						<p>Discover correlation relationships among multiple pathways/gene sets identified by 
						<a target="_blank" href="http://www.broadinstitute.org/gsea/index.jsp">GSEA</a> (gene set enrichment analysis). 
						All the input pathways/gene sets should come from the same collection.
                        <a target="_blank" href="http://www.broadinstitute.org/gsea/msigdb/index.jsp">MSigDB</a> H hallmark gene sets,
						<a target="_blank" href="http://www.broadinstitute.org/gsea/msigdb/index.jsp">MSigDB</a>  C2 Canonical pathways, 
						<a target="_blank" href="http://www.broadinstitute.org/gsea/msigdb/index.jsp">MSigDB</a>  C5 GO BP gene sets, and 
						<a target="_blank" href="http://www.genomemedicine.com/content/5/7/68">Pathprint</a>
						 are treated as four separate collections.</p>
					</div>
				</div>
			</div>
			<div class="row" id="divShareButtons">
				<label>Share PCxN</label>
				<a class="sbg-button sbg-button-facebook"  data-sbg-network="facebook"  data-sbg-url="http://pcxn.org:8080"  data-sbg-title="PCxN The Pathway Co-Activity Map"  data-sbg-summary="A database of correlation between pathways/gene sets."  data-sbg-image="http://pcxn.org:8080/pcxnscreenshot1.png"  data-sbg-width="600"  data-sbg-height="368" >
  					<i class="sbg-button-icon fa fa-facebook"></i>
				</a>
      
				<a class="sbg-button sbg-button-twitter"  data-sbg-network="twitter"  data-sbg-text="http://pcxn.org A database of correlation between pathways and gene sets."  data-sbg-via=""  data-sbg-hashtags="pathway,geneset"  data-sbg-width="600"  data-sbg-height="258" >
  					<i class="sbg-button-icon fa fa-twitter"></i>
				</a>
      
				<a class="sbg-button sbg-button-linkedin"  data-sbg-network="linkedin"  data-sbg-url="http://pcxn.org:8080"  data-sbg-title="PCxN The Pathway Co-Activity Map"  data-sbg-source=""  data-sbg-summary="A database of correlation between pathways/gene sets."  data-sbg-width="585"  data-sbg-height="471" >
  					<i class="sbg-button-icon fa fa-linkedin"></i>
				</a>
      
				<a class="sbg-button sbg-button-google-plus"  data-sbg-network="google-plus"  data-sbg-url="http://pcxn.org:8080"  data-sbg-width="500"  data-sbg-height="505" >
  					<i class="sbg-button-icon fa fa-google-plus"></i>
				</a>
      
				<a class="sbg-button sbg-button-pinterest"  data-sbg-network="pinterest"  data-sbg-url="http://pcxn.org"  data-sbg-media="http://pcxn.org/pcxnscreenshot1.png"  data-sbg-description="A database of correlation between pathways/gene sets."  data-sbg-width="750"  data-sbg-height="322" >
  					<i class="sbg-button-icon fa fa-pinterest"></i>
				</a>
      
				<a class="sbg-button sbg-button-email"  data-sbg-network="email"  data-sbg-subject="PCxN The Pathway Co-Activity Map"  data-sbg-body="A database of correlation between pathways/gene sets, http://pcxn.org" >
  					<i class="sbg-button-icon fa fa-envelope"></i>
				</a>
				<script>
					sbg();
				</script>
			</div>
			<div class="row" id="divResult">
				<div class="row result">
					<div class="col-sm-12 result">
						<div class="col-sm-12 result" id="menu2">
						<label class="result">Show</label>
						<input class="result" type="checkbox" id="checkboxHeatmap" checked="checked">heatmap
						<input class="result" type="checkbox" id="checkboxNetwork" checked="checked">network					
						<input class="result" type="checkbox" id="checkboxNetworkLegend">network legend
						<input class="result" type="checkbox" id="checkboxGeneList">gene list
						<input class="result" type="checkbox" id="checkboxCorrelationTable">network data table				
					</div>
					</div>
				</div>
				<div class="row result">
					<div class="col-sm-12">
						<div class="col-sm-6 result box" id="divHeatmap">
							<!-- The "box" class here is used to find the right DIV when resizing.
                         	See sizeCanvas() -->
							<label>Correlation Heatmap</label>
							<input type="button" id="buttonpng1" value="PNG" onclick="saveHeatmapAsPNG();"/><br>
                        	<!-- This div gets replaced by sizeCanvas() -->
                        	<div>
                            	<canvas id="canvas1"></canvas>
                        	</div>
						</div>						
						<div class="col-sm-6 result row" style="padding-left:30px;" id="divNetwork">
							
							<label class="result" id="netWorkHeadLabel">Correlation Network</label>
							<input type="button" id="buttonjpg" value="JPG" onclick="saveNetworkAsJPG();"/>
							<input type="button" id="buttonjson" value="JSON" onclick="saveNetworkAsJSON();"/>
							<input type="button"  value="Spread" onclick="spreadLayout();" style="float:right;"/>
							<input type="button"  value="Grid" onclick="gridLayout();" style="float:right;"/>
							<input type="button"  value="Circle" onclick="circleLayout();" style="float:right;"/>
							<input type="button"  value="Physics" onclick="colaLayout();" style="float:right;"/>
							<input type="button"  value="Concentric" onclick="concentricLayout();" style="float:right;"/>
<!-- 							<input type="button"  value="Cose-Bilkent" onclick="coseBilkentLayout();" style="float:right;"/> -->
							<input type="button"  value="Center Graph" onclick="centerLayout();" style="float:right;margin-right: 40px; "/>
							<input type="button"  value="Edges" onclick="edgewidth();" style="float:right;margin-right: 40px; "/>
							<div class="col-sm-12 row result box" style="padding-left:30px; padding-top: 7px; ">
                        		<div class="result row">
                            		<div class="result" id="cy"></div>
                        		</div>
                        	</div>
                        	<div class="col-sm-12 result row" id="divSliders" style="padding-top: 15px;">
                        		<div class="col-sm-12 row result" >
									<div class="col-sm-12 row result">
                    					<label class="result" for="amount" style="width: 180px">Min absolute correlation:</label>
                    					<input class="result" size="3" type="range" id="coefficientSlider" min="0.01" max="1" step="0.01" style="width: 150px; display: inline"/>
                    					<input class="result" disabled=true size="3" type="text" id="coefficientText" style="border:0; margin-bottom:0; width: 50px" />
									</div>
									<div class="col-sm-12 row result">
                    					<label class="result" for="pvalueSlider" style="width: 180px">Max correlation p value:</label>
                    					<input class="result" size="3" type="range" id="pvalueSlider" min="0.001" max="0.05" step="0.001" style="width: 150px; display: inline"/>
                    					<input class="result" disabled=true size="3" type="text" id="pvalueText" style="border:0; margin-bottom:0; width: 50px" />   		
                					</div>
                				</div>
                			</div>  
                			              			         
						</div>	
										
						<div class="col-sm-6 result row" id="divGeneList" style="padding-left: 30px;">	
							<label class="result">Gene set (click on a gene set name on heatmap or network to select)</label><br>
							<label class="result">Name</label><br>
							<p class="result" id="selctedLeafName"> </p>
							<label>External links</label><br>
							<a id="selctedLeafNameLink" target="_blank" href=""></a>
							<br><label>Members</label><br>
							<table id="table2" class="display" cellspacing="0" width="100%">
								<thead>
									<tr>
										<th>GeneID</th>
										<th>Symbol</th>
										<th>Description</th>
									</tr>
								</thead>
	
								<tfoot>
									<tr>
										<th>GeneID</th>
										<th>Symbol</th>
										<th>Description</th>
									</tr>
								</tfoot>
							</table>
							<p id="table2waiting" class="waitmessage">Please wait. Getting data ....</p>
					    </div>					
						<div class="col-sm-6 result row" id="divLegend">						
							<canvas id="canvas3" width="450" height="300"></canvas>
						</div>				
					</div>
				</div>				
				<div class="row result" id="divTable1">
					<div class="col-sm-12 result">
						<div class="col-sm-12 result">
							<h3 class="result" >Network Data Table</h3>
							<div class="col-sm-12 result">
								<table id="table1" class="display result" cellspacing="0" width="100%">
									<thead class="result">
										<tr class="result">
											<th class="result">Gene Set A</th>
											<th class="result">Gene Set B</th>
											<th class="result">Correlation</th>
											<th class="result">p Value</th>
											<th class="result">Overlap Coefficient</th>
										</tr>
									</thead>

									<tfoot class="result">
										<tr class="result">
											<th class="result">Gene Set A</th>
											<th class="result">Gene Set B</th>
											<th class="result">Correlation</th>
											<th class="result">p Value</th>
											<th class="result">Overlap Coefficient</th>
										</tr>
									</tfoot>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<br>
		
		<script>
		
		function changeRadioSelection (e){
			//$('#radioSelectGeneSet').prop('checked', true);
			//alert(e.target.id);
			if(e.target.id =="selectPathprint") {
				document.getElementById("radioPathprint").checked = true;
			} else if(e.target.id =="selectMSigDBC2CP") {
				document.getElementById("radioMSigDBC2CP").checked = true;
			} else if(e.target.id =="selectMSigDBC5") {
				document.getElementById("radioMSigDBC5").checked = true;
			} else if(e.target.id =="selectMSigDBH") {
				document.getElementById("radioMSigDBH").checked = true;
			} else {}
			$("#label1").show();
			$("#inputCorrelation2").show();
			$("#label2").show();
			$("#inputpValue2").show();
			$("#button4").show();
			$("#button3").show();
		}
		function geneSetSearchCompleted (e, ui){
			$('#radioSearchGeneSet').prop('checked', true);
			showForm2LowerPart();
		}				
		$( "#textfieldGeneSet" ).on( "autocompleteselect", geneSetSearchCompleted);
		document.getElementById("selectPathprint").addEventListener("change", changeRadioSelection);
		document.getElementById("selectMSigDBC2CP").addEventListener("change", changeRadioSelection);
		document.getElementById("selectMSigDBC5").addEventListener("change", changeRadioSelection);	
        document.getElementById("selectMSigDBH").addEventListener("change", changeRadioSelection);	
		
		function radioAnalysisClick (e) {
			if (e.target.id == "radioAnalysis1") {
				$("#form1").hide();
				$("#form2").show();	
				localStorage.setItem("explore", true);
				checkLocalStorage();		
			} else if (e.target.id == "radioAnalysis2") {
				$("#form2").hide();
				$("#form1").show();
				localStorage.setItem("explore", false);
				checkLocalStorage();
			} else {
				alert("Error. Please contact W.Wei@sheffield.ac.uk");
			}
			$(".result").hide();
		}
		
		function form2RadioClick (e) {
			showForm2LowerPart();			
		}	
		
		function showForm2LowerPart () {
			$("#label1").show();
			$("#inputCorrelation2").show();
			$("#label2").show();
			$("#inputpValue2").show();
			$("#button4").show();
			$("#button3").show();
			$("#divShareButtons").show();
			$(".ui-helper-hidden-accessible").hide();	
		}	
		document.getElementById("radioAnalysis1").addEventListener("click", radioAnalysisClick);
		document.getElementById("radioAnalysis2").addEventListener("click", radioAnalysisClick);
		document.getElementById("radioPathprint").addEventListener("click", form2RadioClick);
		document.getElementById("radioMSigDBC2CP").addEventListener("click", form2RadioClick);
		document.getElementById("radioMSigDBC5").addEventListener("click", form2RadioClick);
        document.getElementById("radioMSigDBH").addEventListener("click", form2RadioClick);
		document.getElementById("radioSearchGeneSet").addEventListener("click", form2RadioClick);
		
		function coefficientSliderChange (e) {
			$("#coefficientText").val($("#coefficientSlider").val());
			if ($("#coefficientSlider").val() > maxCorrInResponseWithQuery) {
				alert("None of the edges connected to the query gene set(s) in the network has absolute correlation coefficient > " + $("#coefficientSlider").val() + ". Notwork has not been changed." ) ;
				$("#coefficientSlider").val(maxCorrInResponseWithQuery);
				$("#coefficientText").val($("#coefficientSlider").val());
				return;
			}
			$("#inputCorrelation").val($("#coefficientSlider").val());
			//javascript:send();
			corrCutOffValue = $("#coefficientSlider").val();
			handleFormResponse(formResponse);				
		}
		
		function coefficientSliderInput (e) {
			$("#coefficientText").val($("#coefficientSlider").val());						
		}
		
		function pvalueSliderChange (e) {
			$("#pvalueText").val($("#pvalueSlider").val());
			if ($("#pvalueSlider").val() < minPValueInResponseWithQuery) {
				alert("None of the edges connected to the query gene set(s) in the network has correlation p value < " + $("#pvalueSlider").val()) ;
			}
			$("#inputpValue").val($("#pvalueSlider").val());				
			//javascript:send();
			pCutOffValue =$("#pvalueSlider").val();
			handleFormResponse(formResponse);				
		}
		
		function pvalueSliderInput (e) {
			$("#pvalueText").val($("#pvalueSlider").val());	
		}
		
		document.getElementById("coefficientSlider").addEventListener("change", coefficientSliderChange);
		document.getElementById("coefficientSlider").addEventListener("input", coefficientSliderInput);
		document.getElementById("pvalueSlider").addEventListener("change", pvalueSliderChange);
		document.getElementById("pvalueSlider").addEventListener("input", pvalueSliderInput);
		
		function displayResults (){
            localStorage.setItem("checkboxHeatmap", document.getElementById("checkboxHeatmap").checked);
            localStorage.setItem("checkboxNetwork", document.getElementById("checkboxNetwork").checked);
            localStorage.setItem("checkboxGeneList", document.getElementById("checkboxGeneList").checked);
            localStorage.setItem("checkboxNetworkLegend", document.getElementById("checkboxNetworkLegend").checked);
            localStorage.setItem("checkboxCorrelationTable", document.getElementById("checkboxCorrelationTable").checked);
			$("#divInput").find('*').hide();
			$("#divInput").hide();
			$("#divShareButtons").hide();
			$(".result").show();
				
			if (document.getElementById("checkboxHeatmap").checked) {
				$("#divHeatmap").parents().show();
				$("#divHeatmap").show();
				$("#divHeatmap").children().show();
			} else {
				$("#divHeatmap").children().hide();
				$("#divHeatmap").hide();
			}
				
			if (document.getElementById("checkboxNetwork").checked) {
				$("#divNetwork").parents().show();
				$("#divNetwork").show();
				$("#divNetwork").children().show();
				$("#netWorkHeadLabel").show();				
				$("#cy").show();
				$("#divSliders").show();
				$("#divSliders").children().show();			
			} else {
				$("#divNetwork").find('*').hide();
				$("#divNetwork").hide();
				$("#divSliders").hide();
				$("#divSliders").children().hide();
			}
								
			if (document.getElementById("checkboxGeneList").checked) {
				$("#divGeneList").parents().show();
				$("#divGeneList").show();
				$("#divGeneList").children().show();
				$("#table2waiting").hide();				
			} else {
				$("#divGeneList").children().hide();
				$("#divGeneList").hide();
			}
						
			if (document.getElementById("checkboxNetworkLegend").checked) {
				$("#divLegend").parents().show();
				$("#divLegend").show();
				$("#divLegend").children().show();
			} else {
				$("#divLegend").children().hide();
				$("#divLegend").hide();
			}
			
			if (document.getElementById("checkboxCorrelationTable").checked) {
				$("#divTable1").parents().show();
				$("#divTable1").show();
				$("#divTable1").children().show();
			} else {
				$("#divTable1").children().hide();
				$("#divTable1").hide();
			}
		}
		
		function checkboxNetworkClick (e) {
			if (document.getElementById("checkboxNetwork").checked) {
				handleFormResponse(formResponse);			
			} else {
				$("#divNetwork").children().hide();
				$("#divNetwork").hide();
				$("#divSliders").children().hide();
				$("#divSliders").hide();
			}
            localStorage.setItem("checkboxCorrelationTable", document.getElementById("checkboxCorrelationTable").checked);
		}
		
		document.getElementById("checkboxHeatmap").addEventListener("click", displayResults);
		document.getElementById("checkboxNetwork").addEventListener("click", checkboxNetworkClick);
		document.getElementById("checkboxNetworkLegend").addEventListener("click", displayResults);
		document.getElementById("checkboxGeneList").addEventListener("click", displayResults);
		document.getElementById("checkboxCorrelationTable").addEventListener("click", displayResults);
	</script>
	</body>
</html>
